<nav class="border-gray-200 bg-gray-900 relative z-50" id="top">
    <div class="w-full flex flex-wrap items-center justify-between mx-auto p-2">
        <div class="flex items-center">
            <img src="/img/SmythOS-text-logo.svg" class="h-6 ml-4" alt="Logo" />
            <span class="self-center text-2xl font-semibold whitespace-nowrap text-white">&nbsp;</span>

            <div class="hidden items-center justify-between w-full md:flex md:w-auto md:order-1" id="navbar-user">
                <ul
                    class="flex flex-col font-medium p-4 md:p-0 mt-4 border border-gray-100 rounded-lg bg-gray-50 md:flex-row md:space-x-8 md:mt-0 md:border-0 bg-gray-800 md:bg-gray-900 border-gray-700">

                </ul>
            </div>
        </div>



        <div class="flex items-center md:order-2 relative">
            <button type="button"
                class="flex mr-3 text-sm bg-gray-800 rounded-full md:mr-0 ring-2 ring-transparent hover:ring-gray-500 focus:ring-gray-300 transition-all duration-150 cursor-pointer"
                id="user-menu-button" aria-expanded="false" aria-haspopup="true" data-dropdown-toggle="user-dropdown"
                data-dropdown-placement="bottom">
                <span class="sr-only">Open user menu</span>
                <% if (user?.picture) { %>
                    <img 
                    class="<%= user?.picture ? 'w-8 h-8' : 'w-10 h-10' %> rounded-full" 
                    src="<%= user?.picture || '/img/user_default.svg' %>" 
                    alt="user photo" 
                    onerror="this.onerror=null;this.src='/img/user_default.svg';"
                >
                <% } else { %>
                    <div class="bg-uipink rounded-full w-8 h-8 flex items-center justify-center text-white font-bold text-2xl">
                        <%= user?.name?.charAt(0).toLowerCase() %>
                    </div>
                <% } %>                 
            </button>
            <!-- Dropdown menu -->
            <div class="z-50 hidden absolute right-0 top-full my-4 text-base list-none divide-y divide-gray-100 rounded-lg shadow-lg bg-gray-700 divide-gray-600 border border-gray-600"
                id="user-dropdown"
                role="menu"
                aria-labelledby="user-menu-button">
                <div class="px-4 pt-3 pb-1">
                    <span class="block text-sm text-gray-900 text-white"><%= user?.name %></span>
                    <span class="block text-sm  text-gray-500 truncate text-gray-400"><%= user?.email %></span>
                </div>
                <ul class="pb-2" aria-labelledby="user-menu-button">
                    <li>
                        <a href="/logto/sign-out"
                            class="block px-4 py-2 text-sm hover:bg-gray-100 hover:bg-gray-600 text-gray-200 hover:text-white">Sign
                            out</a>
                    </li>
                </ul>
            </div>
            <button data-collapse-toggle="navbar-user" type="button"
                class="inline-flex items-center p-2 w-10 h-10 justify-center text-sm rounded-lg md:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 text-gray-400 hover:bg-gray-700 focus:ring-gray-600"
                aria-controls="navbar-user" aria-expanded="false">
                <span class="sr-only">Open main menu</span>
                <svg class="w-5 h-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none"
                    viewBox="0 0 17 14">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M1 1h15M1 7h15M1 13h15" />
                </svg>
            </button>
        </div>
    </div>
</nav>

<script>
/**
 * Initializes dropdown toggle functionality for elements with data-dropdown-toggle attribute.
 * This handles click events on dropdown trigger buttons and closes dropdowns when clicking outside.
 */
(function initDropdownToggles() {
  'use strict';

  // Skip if already initialized (prevents duplicate initialization)
  if (window.__dropdownTogglesInitialized) {
    return;
  }
  window.__dropdownTogglesInitialized = true;

  /**
   * Toggles the visibility of a dropdown menu.
   * @param {HTMLElement} dropdown - The dropdown element to toggle
   * @param {HTMLElement} button - The button that triggered the toggle
   * @param {boolean} show - Whether to show (true) or hide (false) the dropdown
   */
  function toggleDropdown(dropdown, button, show) {
    if (show) {
      dropdown.classList.remove('hidden');
      button.setAttribute('aria-expanded', 'true');
    } else {
      dropdown.classList.add('hidden');
      button.setAttribute('aria-expanded', 'false');
    }
  }

  /**
   * Checks if a dropdown is currently visible.
   * @param {HTMLElement} dropdown - The dropdown element to check
   * @returns {boolean} True if the dropdown is visible
   */
  function isDropdownVisible(dropdown) {
    return !dropdown.classList.contains('hidden');
  }

  /**
   * Closes all open dropdowns except the one specified.
   * @param {HTMLElement|null} exceptDropdown - Dropdown to exclude from closing (optional)
   */
  function closeAllDropdowns(exceptDropdown) {
    var buttons = document.querySelectorAll('[data-dropdown-toggle]');
    buttons.forEach(function(btn) {
      var targetId = btn.getAttribute('data-dropdown-toggle');
      var dropdown = document.getElementById(targetId);
      if (dropdown && dropdown !== exceptDropdown && isDropdownVisible(dropdown)) {
        toggleDropdown(dropdown, btn, false);
      }
    });
  }

  // Initialize click handlers for all dropdown toggle buttons
  document.addEventListener('DOMContentLoaded', function() {
    var toggleButtons = document.querySelectorAll('[data-dropdown-toggle]');

    toggleButtons.forEach(function(button) {
      var targetId = button.getAttribute('data-dropdown-toggle');
      var dropdown = document.getElementById(targetId);

      if (!dropdown) {
        console.warn('Dropdown target not found:', targetId);
        return;
      }

      // Handle button click to toggle dropdown
      button.addEventListener('click', function(event) {
        event.preventDefault();
        event.stopPropagation();

        var shouldShow = !isDropdownVisible(dropdown);

        // Close other dropdowns first
        closeAllDropdowns(dropdown);

        // Toggle this dropdown
        toggleDropdown(dropdown, button, shouldShow);
      });
    });

    // Close dropdowns when clicking outside
    document.addEventListener('click', function(event) {
      var target = event.target;

      // Check if click is inside any dropdown or toggle button
      var clickedInsideDropdown = target.closest('[data-dropdown-toggle], [id$="-dropdown"]');

      if (!clickedInsideDropdown) {
        closeAllDropdowns(null);
      }
    });

    // Close dropdowns when pressing Escape key
    document.addEventListener('keydown', function(event) {
      if (event.key === 'Escape') {
        closeAllDropdowns(null);
      }
    });
  });
})();
</script>